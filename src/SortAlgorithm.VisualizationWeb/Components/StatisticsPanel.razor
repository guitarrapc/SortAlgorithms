@using SortAlgorithm.VisualizationWeb.Models

<div class="statistics-panel">
    <h3>üìä Statistics</h3>

    <div class="stat-section">
        <div class="stat-section-title">‚è± Execution Time</div>
        <div class="stat-item">
            <span class="stat-label">@ExecutionTimeLabel</span>
            <span class="stat-value stat-execution-time">@ExecutionTimeDisplay</span>
        </div>
        @if (State.ActualExecutionTime > TimeSpan.Zero)
        {
            <div class="stat-item">
                <span class="stat-label">Performance</span>
                <span class="stat-value stat-performance">@PerformanceDisplay</span>
            </div>
        }
    </div>
    
    <div class="stat-section">
        <div class="stat-section-title">üî¢ Operations</div>
        <div class="stat-item">
            <span class="stat-label">Comparisons</span>
            <span class="stat-value">@State.CompareCount.ToString("N0")</span>
        </div>
        
        <div class="stat-item">
            <span class="stat-label">Swaps</span>
            <span class="stat-value">@State.SwapCount.ToString("N0")</span>
        </div>
        
        <div class="stat-item">
            <span class="stat-label">Index Reads</span>
            <span class="stat-value">@State.IndexReadCount.ToString("N0")</span>
        </div>
        
        <div class="stat-item">
            <span class="stat-label">Index Writes</span>
            <span class="stat-value">@State.IndexWriteCount.ToString("N0")</span>
        </div>
    </div>

    <div class="stat-item">
        <span class="stat-label">Progress</span>
        <span class="stat-value">@ProgressPercentage.ToString("F1")%</span>
    </div>
    
    <div class="stat-item">
        <span class="stat-label">Status</span>
        <span class="stat-value">@StatusText</span>
    </div>
</div>

@code {
    [Parameter]
    public VisualizationState State { get; set; } = new();
    
    private double ProgressPercentage => State.TotalOperations > 0 
        ? (double)State.CurrentOperationIndex / State.TotalOperations * 100 
        : 0;
    
    private string StatusText => State.PlaybackState switch
    {
        PlaybackState.Playing => "‚ñ∂ Playing",
        PlaybackState.Paused => "‚è∏ Paused",
        PlaybackState.Stopped => "‚èπ Stopped",
        _ => "Unknown"
    };

    private bool IsPlaying => State.PlaybackState == PlaybackState.Playing;

    private string ExecutionTimeLabel => IsPlaying ? "Current" : "Total";

    private string ExecutionTimeDisplay
    {
        get
        {
            if (State.ActualExecutionTime == TimeSpan.Zero)
                return "-";

            if (IsPlaying)
            {
                var current = State.EstimatedCurrentExecutionTime;
                return $"{FormatTime(current)} / {FormatTime(State.ActualExecutionTime)}";
            }

            return FormatTime(State.ActualExecutionTime);
        }
    }

    private string PerformanceDisplay
    {
        get
        {
            if (State.ActualExecutionTime == TimeSpan.Zero || State.TotalOperations == 0)
                return "-";

            var opsPerMs = State.TotalOperations / State.ActualExecutionTime.TotalMilliseconds;

            if (opsPerMs < 1)
                return $"{opsPerMs * 1000:F1} ops/s";
            else if (opsPerMs < 1_000_000)
                return $"{opsPerMs:F0} ops/ms";
            else
                return $"{opsPerMs / 1000:F2} M ops/ms";
        }
    }

    private static string FormatTime(TimeSpan time)
    {
        if (time.TotalNanoseconds < 1000)
            return $"{time.TotalNanoseconds:F0} ns";
        else if (time.TotalMicroseconds < 1000)
            return $"{time.TotalMicroseconds:F1} Œºs";
        else if (time.TotalMilliseconds < 1000)
            return $"{time.TotalMilliseconds:F3} ms";
        else
            return $"{time.TotalSeconds:F3} s";
    }
}

