@using SortAlgorithm.VisualizationWeb.Models
@using SortAlgorithm.VisualizationWeb.Services

@if (IsComparisonMode && ComparisonMode.State.Instances.Any())
{
    @* 比較モード用のコントロール *@
    <div style="display: flex; gap: 10px; margin-top: 10px; align-items: center;">
        <button @onclick="OnReset">⏹ Reset</button>
        <button @onclick="OnTogglePlayPause">
            @(IsPlaying ? "⏸ Pause" : "▶ Play")
        </button>
        
        <span style="flex: 1;"></span>
        
        @* 完了状態の表示 *@
        @if (ComparisonMode.State.AllCompleted)
        {
            <span style="color: #10B981; font-weight: bold;">✅ All Completed!</span>
        }
        else
        {
            var completedCount = ComparisonMode.State.Instances.Count(x => x.State.IsSortCompleted);
            <span style="color: #999;">
                @if (completedCount > 0)
                {
                    <span style="color: #F59E0B;">@completedCount/@ComparisonMode.State.Instances.Count completed</span>
                }
                else
                {
                    <span>Comparing @ComparisonMode.State.Instances.Count algorithms</span>
                }
            </span>
        }
    </div>
}
else
{
    @* 通常モード用のコントロール *@
    <SeekBar CurrentIndex="Playback.State.CurrentOperationIndex"
             TotalOperations="Playback.State.TotalOperations"
             OnSeek="OnSeek" />

    <div style="display: flex; gap: 10px; margin-top: 10px; align-items: center;">
        <button @onclick="OnReset">⏹ Reset</button>
        <button @onclick="OnTogglePlayPause">
            @(Playback.State.PlaybackState == PlaybackState.Playing ? "⏸ Pause" : "▶ Play")
        </button>
        <span style="flex: 1;"></span>
        <span style="color: #999;">Mode: @Playback.State.Mode</span>
    </div>
}

@code {
    [Parameter]
    public bool IsComparisonMode { get; set; }

    [Parameter]
    public bool IsPlaying { get; set; }

    [Parameter, EditorRequired]
    public PlaybackService Playback { get; set; } = default!;

    [Parameter, EditorRequired]
    public ComparisonModeService ComparisonMode { get; set; } = default!;

    [Parameter]
    public EventCallback OnReset { get; set; }

    [Parameter]
    public EventCallback OnTogglePlayPause { get; set; }

    [Parameter]
    public EventCallback<int> OnSeek { get; set; }
}
