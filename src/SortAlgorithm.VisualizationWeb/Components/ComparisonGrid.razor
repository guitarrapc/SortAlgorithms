@using SortAlgorithm.VisualizationWeb.Models
@using SortAlgorithm.VisualizationWeb.Services

<div class="comparison-grid" 
     style="grid-template-columns: repeat(@GetGridColumns(), 1fr);">
    @for (int i = 0; i < Instances.Count; i++)
    {
        var instance = Instances[i];
        var index = i;
        
        <ComparisonGridItem 
            Instance="@instance"
            Playback="@instance.Playback"
            VisualizationMode="@VisualizationMode"
            GridColumnCount="@GetGridColumns()"
            OnRemove="@(() => OnRemoveInstance(index))"
            OnVisualizationClick="@OnVisualizationClick"
            @key="instance.AlgorithmName" />
    }
</div>

@code {
    [Parameter, EditorRequired]
    public List<ComparisonInstance> Instances { get; set; } = null!;
    
    [Parameter]
    public VisualizationMode VisualizationMode { get; set; } = VisualizationMode.BarChart;
    
    [Parameter]
    public EventCallback<int> OnRemove { get; set; }
    
    [Parameter]
    public EventCallback OnVisualizationClick { get; set; }
    
    private int GetGridColumns()
    {
        return Instances.Count switch
        {
            1 => 1,
            2 => 2,
            3 => 3,
            4 => 2,
            5 => 3,
            6 => 3,
            7 => 3,
            8 => 3,
            9 => 3,
            _ => 1
        };
    }
    
    private async Task OnRemoveInstance(int index)
    {
        if (OnRemove.HasDelegate)
        {
            await OnRemove.InvokeAsync(index);
        }
    }
}

