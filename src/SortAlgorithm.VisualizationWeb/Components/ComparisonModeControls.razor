@using SortAlgorithm.VisualizationWeb.Models
@using SortAlgorithm.VisualizationWeb.Services

<div class="stat-item">
    @{
        var isDisabled = ComparisonMode.State.Instances.Count >= ComparisonState.MaxComparisons || !ComparisonMode.State.IsEnabled;
    }
    <button class="primary" 
            @onclick="OnAddAlgorithm" 
            style="width: 100%;"
            disabled="@isDisabled">
        âž• Add to Comparison
    </button>
</div>

<div class="stat-item stat-item-vertical">
    <span class="stat-label">Operations Per Frame</span>
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
        <span class="stat-value" style="font-size: 0.9rem;">@Playback.OperationsPerFrame ops/frame</span>
    </div>
    <input type="range" min="1" max="1000" @bind="Playback.OperationsPerFrame" @bind:after="HandleSpeedChanged" style="width: 100%;" />
</div>

<div class="stat-item stat-item-vertical">
    <span class="stat-label">Speed Multiplier</span>
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
        <span class="stat-value" style="font-size: 0.9rem;">@Playback.SpeedMultiplier.ToString("F1")x</span>
        <span style="font-size: 0.85rem; color: #999;">(@EffectiveFPS FPS)</span>
    </div>
    <input type="range" min="0.5" max="100" step="0.5" @bind="Playback.SpeedMultiplier" @bind:after="HandleSpeedChanged" style="width: 100%;" />
</div>

@code {
    [Parameter, EditorRequired]
    public ComparisonModeService ComparisonMode { get; set; } = default!;

    [Parameter, EditorRequired]
    public PlaybackService Playback { get; set; } = default!;

    [Parameter]
    public EventCallback OnAddAlgorithm { get; set; }

    [Parameter]
    public EventCallback OnSpeedSettingsChanged { get; set; }

    private int EffectiveFPS => (int)(60 * Playback.SpeedMultiplier);

    private async Task HandleSpeedChanged()
    {
        await OnSpeedSettingsChanged.InvokeAsync();
    }
}
